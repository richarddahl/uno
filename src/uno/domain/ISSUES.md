# Uno Domain System â€“ Issues and Review

This document lists all issues and concerns identified in the current implementation of the Uno Domain-Driven Design (DDD) system as of 2025-05-13.

## General Principles & Compliance
- [ ] **Type Hint Consistency:** Sweep for legacy typing (`Optional`, `Union`, etc.) and ensure all type hints use modern Python 3.13+ idioms (`X | None`, `X | Y`).
- [ ] **No Built-in Shadowing:** Audit for class/function/constant names that shadow Python built-ins or imported package names.
- [ ] **No Python Keywords as Identifiers:** Confirm no accidental use of Python keywords as identifiers.
- [ ] **Pydantic v2 Compliance:** Ensure all Pydantic usage is v2 idiomatic (use `ConfigDict`, not `class Config`).

## DDD Patterns & Protocols
- [ ] **Protocol/Implementation Divergence:** There is inconsistency between protocol signatures (async methods in `AggregateRootProtocol`, `EntityProtocol`, etc.) and concrete implementations (many are sync). Align protocol and implementation, or document why divergence is necessary.
- [ ] **Aggregate/Entity/ValueObject Patterns:** Ensure all aggregates, entities, and value objects enforce invariants and validation via explicit methods or Pydantic validators, and that these are covered by tests.
- [ ] **Event Sourcing Consistency:** The event sourcing flow (rehydration, event application, publishing) is split between sync and async methods. Standardize on async or provide clear documentation for when each is used.
- [ ] **Repository Protocols:** Confirm all repositories implement the full protocol (async CRUD, event sourcing, snapshotting if supported), and that type bounds are respected throughout.
- [ ] **Event Sourced Aggregate:** `EventSourcedAggregate` is a stub with no base class or protocol enforcement. Expand or document its intended usage.
- [ ] **Minimal/Empty Files:** `repository.py` is empty. Remove or implement as needed.

## Error Handling & Logging
- [ ] **Error Context Propagation:** Ensure all domain errors propagate full context (aggregate id, event type, etc.) for debugging. Audit custom error classes for completeness.
- [ ] **Logger Injection:** Logger is injected as an attribute but sometimes used without checks (`self._logger.error`). Always check for logger presence or enforce via DI.

## Extensibility, Testability, and Documentation
- [ ] **Internal Documentation:** Some internal/private methods lack docstrings or usage notes. Add for maintainers.
- [ ] **Test Coverage:** No evidence of comprehensive unit tests for error paths, event upcasting, or invariant enforcement. Add/expand tests for these scenarios.
- [ ] **Snapshotting:** Snapshot logic is minimal and not integrated with aggregates or repositories. Specify design or remove if not implemented.
- [ ] **Config/DI Integration:** `config.py` and `di.py` exist but their integration with the domain layer is unclear. Document or refactor.

## Minor/Other Issues
- [ ] **Circular Imports:** Use `TYPE_CHECKING` guards, but audit for possible circular import issues, especially with protocols and errors.
- [ ] **Serialization Contract:** The canonical serialization contract is described in docstrings but should be enforced by tests and utilities.
- [ ] **Redundant/Unused Code:** Remove dead code or stubs (e.g., empty files, unused imports).

---

**Next Steps:**
- Sweep all domain code for modern type hints and Uno idioms
- Standardize sync/async usage in protocols and implementations
- Improve test coverage for invariants, event sourcing, and error paths
- Expand documentation, especially for maintainers and advanced DDD patterns
- Audit for circular imports, dead code, and protocol/implementation mismatches

*Generated by automated review on 2025-05-13.*
